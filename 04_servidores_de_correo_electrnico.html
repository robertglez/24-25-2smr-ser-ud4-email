<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>04| Servidores de correo electrónico | 4. Servicios de email </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Vicent Jordà &amp;&amp; Roberto González" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.9 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="prism.css">
</head>
<body class="exe-web-site exe-search-bar exe-atools" id="exe-node-6"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">4. Servicios de email</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UNIDAD 4. Servicios de e-mail</a></li>
   <li><a href="01_introduccin.html" class="no-ch">01| Introducción</a></li>
   <li><a href="02_funcionamiento_del_servicio.html" class="no-ch">02| Funcionamiento del servicio</a></li>
   <li><a href="03_protocolos_en_la_gestin_de_correo_electrnico.html" class="no-ch">03| Protocolos en la gestión de correo electrónico</a></li>
   <li id="active"><a href="04_servidores_de_correo_electrnico.html" class="active no-ch">04| Servidores de correo electrónico</a></li>
   <li><a href="05_clientes_de_correo_electrnico.html" class="no-ch">05| Clientes de correo electrónico</a></li>
   <li><a href="06_seguridad_y_vulnerabilidades.html" class="no-ch">06| Seguridad y vulnerabilidades</a></li>
   <li><a href="07_cuestionario_de_repaso.html" class="no-ch">07| Cuestionario de repaso</a></li>
   <li><a href="08_actividad_u4aev1_instalacin_de_un_sistema_completo_de_correo.html" class="no-ch">08| Actividad U4.AEV1. Instalación de un sistema completo de correo</a></li>
   <li><a href="09_actividad_u4aev2_sistema_completo_de_correo_en_clienteservidor_con_webmail.html" class="no-ch">09| Actividad U4.AEV2. Sistema completo de correo en cliente-servidor con webmail</a></li>
   <li><a href="10_bibliografa.html" class="no-ch">10| Bibliografía</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="03_protocolos_en_la_gestin_de_correo_electrnico.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><span class="page-counter">Página <strong>5</strong> de <strong>11</strong></span> <span class="sep">| </span><a href="05_clientes_de_correo_electrnico.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">04| Servidores de correo electrónico</h1></header>
<article class="iDevice_wrapper FreeTextIdevice" id="id10">
<div class="iDevice emphasis0">
<div id="ta10_85" class="block iDevice_content">
<p>Como se ha explicado anteriormente, para disponer de un servicio completo de correo electrónico es necesaria la cooperación de varios protocolos, uno de envío de correo (SMTP) y otro de descarga de correo (IMAP o POP3).</p>
<p>En los sistemas <strong>Linux</strong> tenemos varias opciones, algunos ejemplos significativos son:</p>
<ul>
<li>Postfix o Sendmail para el envío (SMTP).</li>
<li>Dovecot o Courier para la descarga (IMAP o POP3).</li>
</ul>
<p>En entornos <strong>Windows</strong>, Microsoft Exchange es la opción más elegida.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextIdevice" id="id11">
<div class="iDevice emphasis0">
<div id="ta11_85" class="block iDevice_content">
<h2>1. Instalación de un servidor de correo electrónico en Ubuntu</h2>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextIdevice" id="id4">
<div class="iDevice emphasis0">
<div id="ta4_86" class="block iDevice_content">
<h3>1.1. Instalación de un MTA: Postfix</h3>
<h4>1.1.1. Postfix</h4>
<p><em>Postfix</em> es el agente de transferencia de correo predeterminado (MTA) en Ubuntu. Intenta ser rápido, fácil de administrar y seguro. Es compatible con el MTA <em>sendmail</em>.</p>
<h4>1.1.2. Configuración de los registros MX</h4>
<p>En esta configuración suponemos que tu dominio es yourdomain.com y que tiene una configuración de registro MX válida como mail.yourdomain.com. Recuerda sustituir yourdomain.com por tu dominio real en los ejemplos de código. También se asume que sabes qué es un registro MX. Para descubrir registros MX, escribe en un terminal:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>dig mx yourdomain.com</code></pre>
</div>
</div>
<h4>1.1.3. Instalación</h4>
<p>Para instalar <em>postfix</em>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo apt-get install postfix</code></pre>
</div>
</div>
<p>Instala el paquete <code>mailx</code> para usarlo como programa de utilidad de correo de órdenes. El comando <code>mail</code> se instala con este paquete.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo apt-get install mailutils</code></pre>
</div>
</div>
<h4>1.1.4. Prueba de la configuración predeterminada</h4>
<p>Añade un usuario antes de comenzar.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo useradd -m -s /bin/bash fmaster
sudo passwd fmaster</code></pre>
</div>
</div>
<p>Prueba tu instalación predeterminada mediante el siguiente segmento de código.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>telnet localhost 25</code></pre>
</div>
</div>
<p>(Si esto no funciona, comprueba si postfix se está ejecutando)</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo service postfix status</code></pre>
</div>
</div>
<p>Si no está ejecutándose, inícialo:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo service postfix start</code></pre>
</div>
</div>
<p>Postfix indicará en el terminal que está funcionando y permitirá escribir comandos SMTP.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>Probando 127.0.0.1 ...
Conectado a localhost.
El carácter de escape es "^]".
220 localhost.localdomain Postfix ESMTP (Ubuntu)</code></pre>
</div>
</div>
<p>Escribe el siguiente código en el indicador de Postfix.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>ehlo localhost
mail from: root@localhost
rcpt to: fmaster@localhost
data
Subject: Mi primer correo en Postfix

Hola,
¿Estás ahí?
Saludos,
Administrador
. (Escribe un punto en una nueva línea y presiona Enter)
quit</code></pre>
</div>
</div>
<p>Consulta el buzón de correo de fmaster:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>su - fmaster
mail</code></pre>
</div>
</div>
<p>Cuando escribas el comando <code>mail</code>, se mostrará una salida similar a la siguiente en el terminal.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>Versión de correo 8.1.2 01/15/2001. Escribe ? para ayuda.
"/var/mail/fmaster": 2 mensajes 2 nuevos
&gt; N 1 root@localhost Mar 6 12:49 13/479 Solo una prueba
  N 2 root@localhost Mar 6 12:51 15/487 Mi primer correo</code></pre>
</div>
</div>
<p>Los correos están indexados por números. Escribe "2" para leer el segundo correo. Escribe "q" para salir. El correo se almacena en un archivo llamado <code>mbox</code> en el directorio personal del usuario, en este caso <code>/home/fmaster/mbox</code>.</p>
<h4>1.1.5. Configuración del soporte de Postfix para buzones en formato Maildir</h4>
<p>Maildir es un formato de almacenamiento de correo electrónico que no requiere bloqueo de archivos para mantener la integridad de los mensajes, ya que cada mensaje se almacena en archivos separados con nombres únicos. Un <em>Maildir</em> es un directorio con tres subdirectorios: tmp, new y cur.</p>
<p>Otra razón para usar Maildir es que los servidores Courier IMAP/POP3 solo funcionan con este formato.</p>
<p>Configura Postfix para usar <code>Maildir</code> en lugar de <code>mbox</code>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo postconf -e "home_mailbox = Maildir/"</code></pre>
</div>
</div>
<p>Asegúrate de que Procmail no está en uso:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo postconf -e "mailbox_command ="</code></pre>
</div>
</div>
<p>Reinicia Postfix para aplicar los cambios.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo service postfix restart</code></pre>
</div>
</div>
<p>Vuelve a probar la configuración.</p>
<p>Consulta el buzón de <code>fmaster</code>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>su - fmaster
MAIL=/home/fmaster/Maildir
mail</code></pre>
</div>
</div>
<h4>1.1.6. Cuestiones de seguridad</h4>
<p>Añade tus redes al parámetro <code>mynetworks</code> para permitir autenticación desde el exterior:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>mynetworks = 192.168.189.0/24, 10.0.216.0/24, 127.0.0.0/8</code></pre>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextIdevice" id="id6">
<div class="iDevice emphasis0">
<div id="ta6_85" class="block iDevice_content">
<h3>1.2. Instalación de un MDA: Dovecot</h3>
<p>Dovecot es un agente de entrega de mensajes (<em>Message Delivery Agent</em>), escrito principalmente con la seguridad en mente. Soporta los principales formatos de buzón: mbox o Maildir. Esta sección explica cómo configurarlo como un servidor IMAP o POP3.</p>
<h4>1.2.1. Instalación</h4>
<p>Para instalar Dovecot, ejecuta el siguiente comando en el terminal:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo apt install dovecot-imapd dovecot-pop3d</code></pre>
</div>
</div>
<h4>1.2.2. Configuración</h4>
<p>Para configurar Dovecot, puedes editar el archivo <code>/etc/dovecot/dovecot.conf</code>. Puedes elegir el protocolo que utilizarás, que puede ser POP3, POP3S (POP3 seguro), IMAP e IMAPS (IMAP seguro). Para obtener más información, consulta los artículos de Wikipedia sobre POP3 e IMAP.</p>
<p>IMAPS y POP3S son más seguros que los simples IMAP y POP3 porque utilizan cifrado SSL para la conexión. Una vez seleccionado el protocolo, modifica la siguiente línea en el archivo <code>/etc/dovecot/dovecot.conf</code>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>protocols = pop3 pop3s imap imaps</code></pre>
</div>
</div>
<p>A continuación, elige el formato de buzón que deseas utilizar. Dovecot admite los formatos <em>maildir</em> y <em>mbox</em>. Estos son los formatos de buzón más utilizados. Ambos tienen sus propios beneficios y están documentados en el sitio web de <em>Dovecot</em>.</p>
<p>Una vez que hayas elegido tu tipo de buzón, edita el archivo <code>/etc/dovecot/conf.d/10-mail.conf</code> y cambia la siguiente línea:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>mail_location = maildir:~/Maildir # (para maildir)</code></pre>
</div>
</div>
<p>o</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>mail_location = mbox:~/mail:INBOX=/var/spool/mail/%u # (para mbox)</code></pre>
</div>
</div>
<p>Debes configurar tu agente de transporte de correo (MTA) para transferir el correo entrante a este tipo de buzón si es diferente del que has configurado.</p>
<p>Ahora permitiremos la autenticación con texto plano desde fuera para simplificar el sistema:</p>
<p>Abre <code>/etc/dovecot/conf.d/10-auth.conf</code> y edita las siguientes líneas para que queden así:</p>
<div class="highlighted-code language-c">
<div>
<pre><code>disable_plaintext_auth = no
auth_mechanisms = plain login</code></pre>
</div>
</div>
<p>Una vez configurado Dovecot, reinicia el servicio para aplicar los cambios:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo service dovecot restart</code></pre>
</div>
</div>
<p>Si has activado <code>imap</code> o <code>pop3</code>, también puedes intentar iniciar sesión con los comandos <code>telnet localhost pop3</code> o <code>telnet localhost imap2</code>. Si ves un mensaje similar al siguiente, la instalación ha sido exitosa:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>bhuvan@rainbow:~$ telnet localhost pop3
Trying 127.0.0.1...
Connected to localhost.localdomain.
Escape character is '^]'.
+OK Dovecot ready.</code></pre>
</div>
</div>
<h4>1.2.3. Configuración de seguridad</h4>
<p>Debes modificar el archivo <code>/etc/dovecot/dovecot.conf</code> y agregar a <code>login_trusted_networks</code> tus direcciones de red para que la autenticación funcione.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>login_trusted_networks = 192.168.1.0/30</code></pre>
</div>
</div>
<p>Puedes probar si funciona siguiendo el siguiente tutorial (las versiones inseguras de los protocolos solo funcionan desde el servidor local): <a href="https://notes.sagredo.eu/en/qmail-notes-185/testing-dovecot-90.html">https://notes.sagredo.eu/en/qmail-notes-185/testing-dovecot-90.html</a></p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextIdevice" id="id5">
<div class="iDevice emphasis0">
<div id="ta5_86" class="block iDevice_content">
<h2>Recursos</h2>
<ul>
<li><a href="https://help.ubuntu.com/community/Postfix#Postfix_Basic_Setup">How To Install and Configure Postfix on Ubuntu 16.04</a></li>
<li><a href="https://help.ubuntu.com/community/PostfixBasicSetupHowto" target="_blank" title="Postfix Basic Setup Howto" rel="noopener">Postfix Basic Setup Howto </a></li>
<li><a href="https://help.ubuntu.com/community/Dovecot">Dovecot </a>en Ubuntu Documentation</li>
<li><a href="https://help.ubuntu.com/lts/serverguide/dovecot-server.html">https://help.ubuntu.com/lts/serverguide/dovecot-server.html</a></li>
</ul>
</div>
</div>
</article>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Reconocimiento Compartir igual 4.0</a></p>
</div>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="03_protocolos_en_la_gestin_de_correo_electrnico.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><span class="page-counter">Página <strong>5</strong> de <strong>11</strong></span> <span class="sep">| </span><a href="05_clientes_de_correo_electrnico.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="class_presentation_js.js"></script>
	<script type="text/javascript" src="prism.js"></script>
	<script type="text/javascript" src="class_presentation_rgc_js.js"></script></body></html>